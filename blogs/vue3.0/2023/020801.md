---
title: vue3跨组件通讯（类似vue2的EventBus）
date: '2023-02-08 18:03:28'
categories:
  - vue3.0
tags: 
  - vue
---

vue3移除了 $on，$off 和 $once 等实例方法，vue3中使用EventBus创建全局事件侦听器的方法已经失效，我们可以使用官方推荐的库替代

### 1.安装这个库[mitt](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fdevelopit%2Fmitt)
$ npm install --save mitt

### 2.mian.js挂载全局
```js
// main.js
import mitt from 'mitt';

const emitter = mitt();
const app = createApp(App);
app.config.globalProperties.$emitter = emitter;
```

### 3.需要触发事件的组件
```js
// 需要触发事件的组件
import { getCurrentInstance } from 'vue'; //获取组件实例
export default {
    ...
    setup(props) {
        const { proxy } = getCurrentInstance();
        proxy.$emitter.on('foo', e => console.log('foo', 'wocao'));
        return {};
    },
};
```

### 4.触发事件的组件
```js
import { getCurrentInstance } from 'vue';
export default {
    setup() {
        ...
        const { proxy } = getCurrentInstance();
        function clickFn() {
            proxy.$emitter.emit('foo', { a: 'b' });
        }
        return { clickFn };
    },
};
```